#[derive(Debug, Clone, Copy)]
pub struct DirectResolver;

impl<T, DB, Ctx> FieldValueResolver<T, DB, Ctx> for DirectResolver
where
    DB: Backend,
    T: GraphQLType<WundergraphScalarValue, TypeInfo = ()> + WundergraphValue,
    T::PlaceHolder: Into<Option<T>> + ::std::fmt::Debug,
    <T as GraphQLType<WundergraphScalarValue>>::Context: FromContext<Ctx>,
{
    fn new(_elements: usize) -> Self {
        Self
    }

    fn resolve_value(
        &mut self,
        value: T::PlaceHolder,
        _look_ahead: &juniper::LookAheadSelection<'_, WundergraphScalarValue>,
        _selection: Option<&'_ [Selection<'_, WundergraphScalarValue>]>,
        executor: &Executor<'_, Ctx, WundergraphScalarValue>,
    ) -> Result<Option<juniper::Value<WundergraphScalarValue>>, Error> {
        Ok(Some(
            executor
                .resolve_with_ctx(&(), &value.into().expect("Loading should not fail"))
                .map_err(|inner| WundergraphError::JuniperError { inner })?,
        ))
    }

    fn finalize(
        self,
        _look_ahead: &juniper::LookAheadSelection<'_, WundergraphScalarValue>,
        _selection: Option<&'_ [Selection<'_, WundergraphScalarValue>]>,
        _executor: &Executor<'_, Ctx, WundergraphScalarValue>,
    ) -> Result<Option<Vec<juniper::Value<WundergraphScalarValue>>>, Error> {
        Ok(None)
    }
}
